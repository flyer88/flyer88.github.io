<html>
<head>
    <meta charset="utf-8"/>
<meta name="description" content=""/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>å†…å­˜æ³„éœ²åˆ†æå®šä½ | é”®ç›˜æ•²å‡»è€…</title>
<link rel="shortcut icon" href="https://flyer88.github.io/favicon.ico?v=1592271814721">
<link href="https://cdn.bootcss.com/font-awesome/5.11.2/css/all.css" rel="stylesheet">
<link rel="stylesheet" href="https://flyer88.github.io/styles/main.css">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
      integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

<script src="https://cdn.bootcss.com/highlight.js/9.15.10/highlight.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.15.10/languages/dockerfile.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.15.10/languages/dart.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.15.10/languages/go.min.js"></script>
<script src="https://cdn.bootcss.com/moment.js/2.23.0/moment.min.js"></script>
<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
        integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
        integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
        crossorigin="anonymous"></script>

<!-- DEMO JS -->
<!--<script src="media/scripts/index.js"></script>-->


    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-57136418-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }

        gtag('js', new Date());
        gtag('config', 'UA-57136418-1');
    </script>


    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
</head>
<body>
<div class="main gt-bg-theme-color-first">
    <nav class="navbar navbar-expand-lg">
    <div class="navbar-brand">
        <img class="user-avatar" src="/images/avatar.png" alt="å¤´åƒ">
        <div class="site-name gt-c-content-color-first">
            é”®ç›˜æ•²å‡»è€…
        </div>
    </div>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <i class="fas fa-bars gt-c-content-color-first" style="font-size: 18px"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <div class="navbar-nav mr-auto" style="text-align: center">
            
                <div class="nav-item">
                    
                        <a href="/" class="menu gt-a-link">
                            é¦–é¡µ
                        </a>
                    
                </div>
            
                <div class="nav-item">
                    
                        <a href="/archives" class="menu gt-a-link">
                            å½’æ¡£
                        </a>
                    
                </div>
            
                <div class="nav-item">
                    
                        <a href="/tags" class="menu gt-a-link">
                            æ ‡ç­¾
                        </a>
                    
                </div>
            
                <div class="nav-item">
                    
                        <a href="https://flyer88.github.io/post/ge-ren-jian-li" class="menu gt-a-link">
                            ä¸ªäººç®€å†
                        </a>
                    
                </div>
            
        </div>
    </div>
</nav>
    <div class="post-container">
        <div class="post-detail gt-bg-theme-color-second">
            <article class="gt-post-content">
                <h2 class="post-title">
                    å†…å­˜æ³„éœ²åˆ†æå®šä½
                </h2>
                <div class="post-info">
                    <time class="post-time gt-c-content-color-first">
                        Â· 2020-06-15 Â·
                    </time>
                    
                        <a href="https://flyer88.github.io/tag/android2/" class="post-tags">
                            # Android è¿›é˜¶
                        </a>
                    
                        <a href="https://flyer88.github.io/tag/tools/" class="post-tags">
                            # å¼€å‘å·¥å…·
                        </a>
                    
                </div>
                <div class="post-content">
                    <ul>
<li><strong>å†…å­˜æ³„éœ²æ ¹æœ¬åŸå› </strong></li>
<li><strong>å†…å­˜æ³„éœ²å¸¸è§æƒ…å†µ</strong></li>
<li><strong>å†…å­˜æ³„éœ²å®šä½æ–¹æ¡ˆ</strong></li>
<li><strong>æœ€è¿‘ç¢°åˆ°çš„ç¤ºä¾‹</strong></li>
<li><strong>å¸¸è§å†…å­˜æ³„éœ²è§£å†³æ–¹æ¡ˆ</strong></li>
</ul>
<blockquote>
<p>è¯¥ç« èŠ‚éœ€é…åˆ <code>Java GC</code> æœºåˆ¶ ä¸€èµ·çœ‹</p>
</blockquote>
<h3 id="0x0001-å†…å­˜æ³„éœ²æ ¹æœ¬åŸå› ">0x0001. å†…å­˜æ³„éœ²æ ¹æœ¬åŸå› </h3>
<ol>
<li>
<p><strong><code>GCRoot</code> å¯¹è±¡é•¿æœŸæŒæœ‰å…¶ä»–å·²ç»æ— ç”¨çš„å¯¹è±¡ï¼ˆæœ¬è¯¥è¢«å›æ”¶ï¼Œå´æœªè¢«å›æ”¶ï¼‰</strong>ã€‚é€šä¿—çš„è¯´å°±æ˜¯ <strong>ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡ï¼ˆå¦‚ static ç±»ï¼‰æŒæœ‰ç”Ÿå‘½å‘¨æœŸè¾ƒçŸ­çš„å¯¹è±¡çš„å¼•ç”¨ï¼ˆæŸä¸ª Activityï¼‰</strong></p>
</li>
<li>
<p><code>GCRoot</code> å¯¹è±¡åŒ…æ‹¬</p>
<ol>
<li>
<p>æ–¹æ³•åŒºé™æ€å±æ€§ ï¼Œå¸¸é‡ï¼ˆå¤šæ•°ä¼´éšæ•´ä¸ªè™šæ‹Ÿæœºçš„ç”Ÿå‘½å‘¨æœŸï¼‰</p>
</li>
<li>
<p>æ ˆå¸§ä¸­æœ¬åœ°å˜é‡è¡¨ä¸­çš„å¼•ç”¨å¯¹è±¡ ï¼ˆå³å½“å‰çº¿ç¨‹æ­£åœ¨è¿è¡Œçš„ä»£ç æŒæœ‰çš„å¯¹è±¡ï¼‰</p>
</li>
<li>
<p>JNI æœ¬åœ°æ–¹æ³•å¼•ç”¨çš„å¯¹è±¡ ï¼ˆnative åŒºå¼•ç”¨çš„å¯¹è±¡ï¼‰</p>
</li>
</ol>
</li>
</ol>
<h3 id="0x0002-å†…å­˜æ³„éœ²å¸¸è§æƒ…å†µ">0x0002. å†…å­˜æ³„éœ²å¸¸è§æƒ…å†µ</h3>
<ol>
<li>
<p>é™æ€å¯¹è±¡</p>
<ul>
<li>
<p><code>static activity</code></p>
</li>
<li>
<p><code>static view</code></p>
</li>
</ul>
</li>
<li>
<p><code>activity/fragment</code> é”€æ¯ï¼Œç»“æŸè€—æ—¶ä»»åŠ¡(å¼‚æ­¥ç½‘ç»œè¯·æ±‚)</p>
</li>
<li>
<p><code>inner class</code> å­˜åœ¨å¼‚æ­¥ç­‰æƒ…å†µ</p>
</li>
<li>
<p><code>SingleInstance</code> æŒæœ‰å±€éƒ¨ç”Ÿå‘½å‘¨æœŸ <code>Activity</code></p>
</li>
<li>
<p>èµ„æºç±» <code>cursor</code> æ²¡æœ‰å…³é—­</p>
</li>
</ol>
<blockquote>
<p>è¡¥å……ï¼Œ<code>lamda</code> è¡¨è¾¾å¼æ˜¯åŒ¿åå†…éƒ¨ç±»</p>
</blockquote>
<h3 id="0x0003-å†…å­˜æ³„éœ²å®šä½æ–¹æ¡ˆ">0x0003. å†…å­˜æ³„éœ²å®šä½æ–¹æ¡ˆ</h3>
<ol>
<li>
<p>é™æ€åˆ†æ</p>
<p>è·‘ <code>Lint</code>ï¼Œæ³¨æ„çœ‹ <code>Warning</code> ï¼Œä¼šé’ˆå¯¹ <code>handler</code> ç­‰ï¼Œè¿›è¡Œæç¤º</p>
</li>
<li>
<p>åŠ¨æ€åˆ†æ</p>
<ul>
<li><code>leakCanary</code></li>
<li><code>adb shell dumpsys meminfo [PackageName]</code></li>
<li><code>Android Profiler</code> (è§ä¸‹æ–¹å†…å­˜æ³„éœ²å®ä¾‹è¯¦è§£)</li>
</ul>
<p>ä»¥ä¸Šä¸‰è€…ï¼Œæ ¹æ®ä¸ªäººç»éªŒå¯ä»¥ç»“åˆèµ·æ¥ä½¿ç”¨</p>
<ol>
<li><code>leakCanary</code> å¯ä»¥ç”¨äºå¿«é€Ÿå®šä½å†…å­˜æ³„éœ²é—®é¢˜</li>
<li>å½“é¢å¯¹ <code>leakCanary</code> æ— æ³•ç›´æ¥ç¡®å®šå†…å­˜æ³„éœ²çš„æ—¶ï¼Œå¯ä»¥ç”¨ <code>adb shell dumpsys</code> è¿›è¡Œè¾…åŠ©ç¡®è®¤æ³„éœ² <code>activity</code></li>
<li>æ ¹æ®å‰ä¸¤è€…ç¡®å®šçš„ <code>activity</code> é…åˆ <code>Android Profiler</code> <code>GC</code> åè¿›è¡Œåˆ†æï¼ŒæŸ¥çœ‹æ²¡æœ‰å›æ”¶çš„å¯¹è±¡çš„å¼•ç”¨é“¾ï¼Œå³å¯å®šä½å†…å­˜æ³„æ¼ä½ç½®</li>
</ol>
</li>
</ol>
<h3 id="0x0004-æœ€è¿‘ç¢°åˆ°çš„ç¤ºä¾‹">0x0004.  æœ€è¿‘ç¢°åˆ°çš„ç¤ºä¾‹</h3>
<p>â€‹	èƒŒæ™¯ä»‹ç»ï¼š ä¸€ä¸ªå•†å“è¯¦æƒ…é¡µï¼Œæœ‰å†…å­˜æ³„éœ² ã€‚</p>
<ol>
<li>
<p><code>LeakCanary</code>  æŠ¥é”™æˆªå›¾ï¼Œå‘ç°æ˜¯ä¸€ä¸ª <code>UI</code> æ¶ˆæ¯é˜Ÿåˆ—ä¸Šçš„ä¸€æ¡æ¶ˆæ¯æ³„éœ²äº†ï¼Œæ— æ³•ç›´æ¥å®šä½å…·ä½“ä»£ç ã€‚<br>
<img src="https://flyer88.github.io/post-images/1592235944966.png" alt="img" loading="lazy"></p>
</li>
<li>
<p>æ­¤æ—¶ï¼Œåˆ©ç”¨ <code>adb shell dumpsys meminfo</code>ï¼Œç„¶åå¤šæ¬¡è¿›å‡º <code>SpuDetailActivity</code> ï¼ŒéªŒè¯ç¡®è®¤æ˜¯ <code>SpuDetailActivity</code> å­˜åœ¨æ³„éœ²ã€‚</p>
</li>
</ol>
<pre><code class="language-shell">âœ adb shell dumpsys meminfo com.leixun.taofen8.haoda
Applications Memory Usage (in Kilobytes):
Uptime: 693212294 Realtime: 787382396

** MEMINFO in pid 14754 [com.leixun.taofen8.haoda] **
                   Pss  Private  Private  SwapPss     Heap     Heap     Heap
                 Total    Dirty    Clean    Dirty     Size    Alloc     Free
                ------   ------   ------   ------   ------   ------   ------
  Native Heap    74230    74108        0      230    98688    86999    11688
  Dalvik Heap     6442     5952        0       25    11519     5760     5759
 Dalvik Other     2683     2680        0        4
        Stack       84       84        0        0
       Ashmem        2        0        0        0
      Gfx dev    28316    28316        0        0
    Other dev       28        0       28        0
     .so mmap    15415      280     7720        7
    .jar mmap     3762        0     1844        0
    .apk mmap      432        0      132        0
    .ttf mmap      107        0       48        0
    .dex mmap    19419    19344       32        0
    .oat mmap      621        0        4        0
    .art mmap     4696     4108        0        9
   Other mmap     5421      476     3348        0
      Unknown     2842     2808        0        6
        TOTAL   164781   138156    13156      281   110207    92759    17447

 App Summary
                       Pss(KB)
                        ------
           Java Heap:    10060
         Native Heap:    74108
                Code:    29404
               Stack:       84
            Graphics:    28316
       Private Other:     9340
              System:    13469

               TOTAL:   164781       TOTAL SWAP PSS:      281

 Objects
               Views:      341         ViewRootImpl:        2
         AppContexts:        7           Activities:        2
              Assets:       18        AssetManagers:        0
       Local Binders:       25        Proxy Binders:       37
       Parcel memory:       11         Parcel count:       48
    Death Recipients:        2      OpenSSL Sockets:       13
            WebViews:        0

 SQL
         MEMORY_USED:        0
  PAGECACHE_OVERFLOW:        0          MALLOC_SIZE:        0
 
 Asset Allocations
      : 162K
</code></pre>
<ol start="3">
<li>
<p>ç”±äºä¸ªäººç»éªŒä¸°å¯Œï¼Œç›´æ¥å€ŸåŠ© <code>LeakCanary</code> å’Œ <code>adb shell dumpsys meminfo</code> é…åˆå‡ æ¬¡è¯•é”™ï¼Œå®šä½åˆ°é—®é¢˜</p>
<blockquote>
<p>æ•´ä¸ªæ¨å¯¼æµç¨‹ï¼š</p>
<p><code>UI</code> -&gt; <code>Handler</code> -&gt; <code>MutableLiveData</code> -&gt; <code>MutableLiveData.observe()</code></p>
<p><code>UI</code> æ¶ˆæ¯å‘é€ï¼Œè‡ªå·±ä»£ç ä¸­æ²¡æœ‰ <code>handler</code> ä¹‹ç±»çš„ï¼Œç”¨äº†åªæœ‰ <code>MutableLiveData</code> æ¥æ›´æ–° <code>View</code>ï¼Œå¿«é€Ÿå®šä½ä¸¤ä¸ª <code>LiveData Observe</code> çš„ä»£ç ï¼Œé…åˆ <code>adb shell dumpsys meminfo</code> ç›´æ¥éªŒè¯æ³¨é‡Šæ‰å‡ ä¸ªæ–¹æ³•ï¼Œçœ‹ <code>Activity</code> æ•°é‡ï¼Œå¿«é€Ÿå®šä½å‡ºé—®é¢˜å‡ºåœ¨ <code>spuDetailBinding.hdPtrList.refreshComplete()</code>ï¼Œ è¯¥ç¬¬ä¸‰æ–¹åº“è°ƒç”¨é”™è¯¯æ—¶ä¼šå‡ºç°å†…å­˜æ³„éœ²ã€‚</p>
</blockquote>
<pre><code class="language-java">...       
  viewModel.loadSuccess.observe(this, aBoolean -&gt; {
      	if (aBoolean) {
      		adapter.submitList(viewModel.itemViewModels);
      	}
      	hideProgressDialog();
      	spuDetailBinding.hdPtrList.refreshComplete();
   });
   viewModel.loadRelatedSuccess.observe(this, aBoolean -&gt; {
       adapter.submitList(viewModel.itemViewModels);
   });
 ...
</code></pre>
</li>
<li>
<p><code>Android Profiler</code> å†…å­˜è¿›è¡Œä¸¾ä¾‹æ€§åˆ†æï¼Œå®šä½é—®é¢˜æ‰€åœ¨</p>
</li>
</ol>
<blockquote>
<p>ä½¿ç”¨ <code>profiler</code> çš„æ—¶å€™ï¼Œæœ€å¥½æŠŠ <code>leakCanary</code> å»æ‰ï¼Œå½±å“æ‰‹åŠ¨ <code>GC</code>ï¼Œè€Œä¸”è¿˜ä¼šå¼•èµ·å¡é¡¿</p>
<p>ä¸ç†Ÿç»ƒ <code>profiler</code>ï¼Œå¯ä»¥é…åˆ <a href="https://developer.android.com/studio/profile/memory-profiler">Android Profiler å®˜æ–¹ä½¿ç”¨æŒ‡å—</a>é£Ÿç”¨</p>
</blockquote>
<ol>
<li>
<p><strong>è¿æ¥ <code>profiler</code></strong><br>
<img src="https://flyer88.github.io/post-images/1592235971126.png" alt="ğŸ˜€" loading="lazy"><br>
â€‹</p>
</li>
<li>
<p><strong>æ‰‹åŠ¨è§¦å‘<code>GC</code></strong><br>
<img src="https://flyer88.github.io/post-images/1592235992860.png" alt="ğŸ˜" loading="lazy"></p>
</li>
<li>
<p><strong>é€‰ä¸­å†…å­˜åŒºåŸŸï¼Œæ‰¾åˆ°æ³„éœ²çš„ <code>Activity</code></strong><br>
<img src="https://flyer88.github.io/post-images/1592236015842.png" alt="ğŸ˜‚" loading="lazy"></p>
</li>
<li>
<p>æ ¹æ®ä¹‹å‰ <code>LeakCanary</code> æŠ¥é”™ï¼Œç›´æ¥å®šä½ <code>MessageQueue</code> æŒæœ‰çš„å¯¹è±¡<br>
<img src="https://flyer88.github.io/post-images/1592236028325.png" alt="ğŸ¤£" loading="lazy"></p>
</li>
</ol>
<h3 id="0x0005-å¸¸è§å†…å­˜æ³„éœ²è§£å†³æ–¹æ¡ˆ">0x0005. å¸¸è§å†…å­˜æ³„éœ²è§£å†³æ–¹æ¡ˆ</h3>
<ol>
<li><code>WeakReference</code> è¿›è¡ŒåŒ…è£¹</li>
<li>ç”¨è°·æ­Œå®˜æ–¹æä¾›çš„ç”Ÿå‘½å‘¨æœŸç»„ä»¶ï¼Œç±»ä¼¼ <code>MutableLiveData</code> ä¹‹ç±»çš„</li>
</ol>

                </div>
            </article>
        </div>

        
            <div class="next-post">
                <div class="next gt-c-content-color-first">ä¸‹ä¸€ç¯‡</div>
                <a href="https://flyer88.github.io/post/jiu-ru-he-shi-xian-rxjava-de-lian-shi-diao-yong-flatmap-fang-fa-de-shi-xian/" class="post-title gt-a-link">
                    ã€æ—§ã€‘å¦‚ä½•å®ç° RxJava çš„é“¾å¼è°ƒç”¨ -- flatmap æ–¹æ³•çš„å®ç°
                </a>
            </div>
        

        

        
            
                <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

<div id="gitalk-container"></div>

<script>

  var gitalk = new Gitalk({
    clientID: '8f894d7af601ea18e6b9',
    clientSecret: '70f1cea8fb683c4dbf8e1b94f676ae3f3c4311a3',
    repo: 'flyer88.github.io',
    owner: 'flyer88',
    admin: ['flyer88'],
    id: location.pathname,      // Ensure uniqueness and length less than 50
    distractionFreeMode: false  // Facebook-like distraction free mode
  })

  gitalk.render('gitalk-container')

</script>

            

            
        

        

        <div class="site-footer gt-c-content-color-first">
    <div class="slogan gt-c-content-color-first">çˆªå“‡å²›ä¸Šç¨‹åºçŒ¿ åæŒ‡å¼¯å¼¯ä¸å¼„å¼¦ 
æ–—å®¤æ–¹å±åä½™å¯¸ ä¸çŸ¥ä»Šå¤•æ˜¯ä½•å¹´</div>
    <div class="social-container">
        
            
                <a href="http://github.com/flyer88" target="_blank">
                    <i class="fab fa-github gt-c-content-color-first"></i>
                </a>
            
        
            
                <a href="https://twitter.com/flyerXu88" target="_blank">
                    <i class="fab fa-twitter gt-c-content-color-first"></i>
                </a>
            
        
            
        
            
                <a href="https://www.zhihu.com/people/baiyanwu" target="_blank">
                    <i class="fab fa-zhihu gt-c-content-color-first"></i>
                </a>
            
        
            
        
            
        
    </div>
    <div class="footer-info">
        Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
    </div>
    <div>
        Theme by <a href="https://imhanjie.com/" target="_blank">imhanjie</a>, Powered by <a
                href="https://github.com/getgridea/gridea" target="_blank">Gridea | <a href="https://flyer88.github.io/atom.xml" target="_blank">RSS</a></a>
    </div>
</div>

<script>
    hljs.initHighlightingOnLoad()
</script>

    </div>
</div>
</body>
</html>
